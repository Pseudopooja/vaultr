<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Make a vault client — vault_client • vaultr</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Make a vault client — vault_client" />

<meta property="og:description" content="Make a vault client.  This must be done before accessing the
vault.  The default values for arguments are controlled by
environment variables (see Details) and values provided as
arguments override these defaults." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vaultr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/vaultr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/packages.html">Using vaultr in packages</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/vimc/vaultr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Make a vault client</h1>
    <small class="dont-index">Source: <a href='https://github.com/vimc/vaultr/blob/master/R/vault_client.R'><code>R/vault_client.R</code></a></small>
    <div class="hidden name"><code>vault_client.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Make a vault client.  This must be done before accessing the
vault.  The default values for arguments are controlled by
environment variables (see Details) and values provided as
arguments override these defaults.</p>
    
    </div>

    <pre class="usage"><span class='fu'>vault_client</span>(<span class='kw'>login</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>, <span class='kw'>addr</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>tls_config</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>login</th>
      <td><p>Login method.  Specify a string to be passed along as
the <code>method</code> argument to <code>$login</code>.  The default
<code>FALSE</code> means not to login.  <code>TRUE</code> means to login
using a default method specified by the environment variable
<code>VAULTR_AUTH_METHOD</code> - if that variable is not set, an
error is thrown.  The value of <code>NULL</code> is the same as
<code>TRUE</code> but does not throw an error if
<code>VAULTR_AUTH_METHOD</code> is not set.  Supported methods are
<code>token</code>, <code>github</code> and <code>userpass</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed along to the authentication
method indicated by <code>login</code>, if used.</p></td>
    </tr>
    <tr>
      <th>addr</th>
      <td><p>The value address <em>including protocol and port</em>,
e.g., <code>https://vault.example.com:8200</code>.  If not given, the
default is the environment variable <code>VAULT_ADDR</code>, which is
the same as used by vault's command line client.</p></td>
    </tr>
    <tr>
      <th>tls_config</th>
      <td><p>TLS (https) configuration.  For most uses this
can be left blank.  However, if your vault server uses a
self-signed certificate you will need to provide this.  Defaults
to the environment variable <code>VAULT_CAPATH</code>, which is the
same as vault's command line client.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="environment-variables"><a class="anchor" href="#environment-variables"></a>Environment variables</h2>

    
    <p>The creation of a client is affected by a number of environment
  variables, following the main vault command line client.</p>
<dl class='dl-horizontal'>
    <dt><code>VAULT_ADDR</code></dt><dd><p>The url of the vault server.  Must
  include a protocol (most likely <code>https://</code> but in testing
  <code>http://</code> might be used)</p></dd>
    <dt><code>VAULT_CAPATH</code></dt><dd><p>The path to CA certificates</p></dd>
    <dt><code>VAULT_TOKEN</code></dt><dd><p>A vault token to use in authentication.
  Only used for token-based authentication</p></dd>
    <dt><code>VAULT_AUTH_GITHUB_TOKEN</code></dt><dd><p>As for the command line
  client, a github token for authentication using the github
  authentication backend</p></dd>
    <dt><code>VAULTR_AUTH_METHOD</code></dt><dd><p>The method to use for
  authentication</p></dd>
    </dl>
    
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    
    <dl class='dl-horizontal'>
<dt><code>api</code></dt><dd><p>Returns an api client object that can be used to directly interact with the vault server.
  <br /><em>Usage:</em><pre>api()</pre></p></dd>
<dt><code>read</code></dt><dd><p>Read a value from the vault.  This can be used to read any value that you have permission to read, and can also be used as an interface to a version 1 key-value store (see <code><a href='vault_client_kv1.html'>vault_client_kv1</a></code>.  Similar to the vault CLI command <code>vault read</code>.
  <br /><em>Usage:</em><pre>read(path, field = NULL, metadata = FALSE)</pre>
    <em>Arguments:</em>
  <ul>
<li><p><code>path</code>:   Path for the secret to read, such as <code>/secret/mysecret</code></p></li>
<li><p><code>field</code>:   Optional field to read from the secret.  Each secret is stored as a key/value set (represented in R as a named list) and this is equivalent to using <code>[[field]]</code> on the return value. The default, <code>NULL</code>, returns the full set of values.</p></li>
<li><p><code>metadata</code>:   Logical, indicating if we should return metadata for this secret (lease information etc) as an attribute along with the values itself.  Ignored if <code>field</code> is specified.</p></li>
</ul></p></dd>
<dt><code>write</code></dt><dd><p>Write data into the vault.  This can be used to write any value that you have permission to write, and can also be used as an interface to a version 1 key-value store (see <code><a href='vault_client_kv1.html'>vault_client_kv1</a></code>.  Similar to the vault CLI command <code>vault write</code>.
  <br /><em>Usage:</em><pre>write(path, data)</pre>
    <em>Arguments:</em>
  <ul>
<li><p><code>path</code>:   Path for the secret to write, such as <code>/secret/mysecret</code></p></li>
<li><p><code>data</code>:   A named list of values to write into the vault at this path. This <em>replaces</em> any existing values.</p></li>
</ul></p></dd>
<dt><code>list</code></dt><dd><p>List data in the vault at a given path.  This can be used to list keys, etc (e.g., at <code>/secret</code>).
  <br /><em>Usage:</em><pre>list(path, full_names = FALSE)</pre>
    <em>Arguments:</em>
  <ul>
<li><p><code>path</code>:   The path to list</p></li>
<li><p><code>full_names</code>:   Logical, indicating if full paths (relative to the vault root) should be returned.</p></li>
</ul>
    <em>Value</em>:
  A character vector (of zero length if no keys are found).  Paths that are "directories" (i.e., that contain keys and could themselves be listed) will be returned with a trailing forward slash, e.g. <code>path/</code></p></dd>
<dt><code>delete</code></dt><dd><p>Delete a value from the vault
  <br /><em>Usage:</em><pre>delete(path)</pre>
    <em>Arguments:</em>
  <ul>
<li><p><code>path</code>:   The path to delete</p></li>
</ul></p></dd>
<dt><code>login</code></dt><dd><p>Login to the vault.  This method is more complicated than most.
  <br /><em>Usage:</em><pre>login(..., method = "token", mount = NULL, renew = FALSE,
      quiet = FALSE, token_only = FALSE, use_cache = TRUE)</pre>
    <em>Arguments:</em>
  <ul>
<li><p><code>...</code>:   Additional named parameters passed through to the underlying method</p></li>
<li><p><code>method</code>:   Authentication method to use, as a string.  Supported values include <code>token</code> (the default), <code>github</code>, <code>approle</code> and <code>userpass</code>.</p></li>
<li><p><code>mount</code>:   The mount path for the authentication backend, <em>if it has been mounted in a nonstandard location</em>.  If not given, then it is assumed that the backend was mounted at a path corresponding to the method name.</p></li>
<li><p><code>renew</code>:   Login, even if we appear to hold a valid token.  If <code>FALSE</code> and we have a token then <code>login</code> does nothing.</p></li>
<li><p><code>quiet</code>:   Suppress some informational messages</p></li>
<li><p><code>token_only</code>:   Logical, indicating that we do not want to actually log in, but instead just generate a token and return that.  IF given then <code>renew</code> is ignored and we always generate a new token.</p></li>
<li><p><code>use_cache</code>:   Logical, indicating if we should look in the session cache for a token for this client.  If this is <code>TRUE</code> then when we log in we save a copy of the token for this session and any subsequent calls to <code>login</code> at this vault address that use <code>use_cache = TRUE</code> will be able to use this token.  Using cached tokens will make using some authentication backends that require authentication with external resources (e.g., <code>github</code>) much faster.</p></li>
</ul></p></dd>
<dt><code>status</code></dt><dd><p>Return the status of the vault server, including whether it is sealed or not, and the vault server version.
  <br /><em>Usage:</em><pre>status()</pre></p></dd>
<dt><code>unwrap</code></dt><dd><p>Returns the original response inside the given wrapping token. The vault endpoints used by this method perform validation checks on the token, returns the original value on the wire rather than a JSON string representation of it, and ensures that the response is properly audit-logged.
  <br /><em>Usage:</em><pre>unwrap(token)</pre>
    <em>Arguments:</em>
  <ul>
<li><p><code>token</code>:   Specifies the wrapping token ID</p></li>
</ul></p></dd>
<dt><code>wrap_lookup</code></dt><dd><p>Look up properties of a wrapping token.
  <br /><em>Usage:</em><pre>wrap_lookup(token)</pre>
    <em>Arguments:</em>
  <ul>
<li><p><code>token</code>:   Specifies the wrapping token ID to lookup</p></li>
</ul></p></dd>
</dl>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>

<span class='co'># We work with a test vault server here (see ?vault_test_server) for</span>
<span class='co'># details.  To use it, you must have a vault binary installed on your</span>
<span class='co'># system.  These examples will not affect any real running vault</span>
<span class='co'># instance that you can connect to.</span>
<span class='no'>server</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>vaultr</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/vaultr/topics/vault_test_server'>vault_test_server</a></span>(<span class='kw'>if_disabled</span> <span class='kw'>=</span> <span class='no'>message</span>)</div><div class='output co'>#&gt; <span class='message'>...waiting for Vault to start</span></div><div class='input'>
<span class='co'># Create a vault_client object by providing the address of the vault</span>
<span class='co'># server.</span>
<span class='no'>client</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>vaultr</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/vaultr/topics/vault_client'>vault_client</a></span>(<span class='kw'>addr</span> <span class='kw'>=</span> <span class='no'>server</span>$<span class='no'>addr</span>)

<span class='co'># The client has many methods, grouped into a structure:</span>
<span class='no'>client</span></div><div class='output co'>#&gt; &lt;vault: client&gt;
#&gt;   Command groups:
#&gt;     audit: Interact with vault's audit devices
#&gt;     auth: administer vault's authentication methods
#&gt;     operator: Administration commands for vault operators
#&gt;     policy: Interact with policies
#&gt;     secrets: Interact with secret engines
#&gt;     token: Interact and configure vault's token support
#&gt;     tools: General tools provided by vault
#&gt;   Commands:
#&gt;     api()
#&gt;     delete(path)
#&gt;     help()
#&gt;     list(path, full_names = FALSE)
#&gt;     login(..., method = "token", mount = NULL, renew = FALSE,
#&gt;         quiet = FALSE, token_only = FALSE, use_cache = TRUE)
#&gt;     read(path, field = NULL, metadata = FALSE)
#&gt;     status()
#&gt;     unwrap(token)
#&gt;     wrap_lookup(token)
#&gt;     write(path, data)</div><div class='input'>
<span class='co'># For example, token related commands:</span>
<span class='no'>client</span>$<span class='no'>token</span></div><div class='output co'>#&gt; &lt;vault: token&gt;
#&gt;   Commands:
#&gt;     capabilities(path, token)
#&gt;     capabilities_accessor(path, accessor)
#&gt;     capabilities_self(path)
#&gt;     client()
#&gt;     create(role_name = NULL, id = NULL, policies = NULL, meta = NULL,
#&gt;         orphan = FALSE, no_default_policy = FALSE, max_ttl = NULL,
#&gt;         display_name = NULL, num_uses = 0L, period = NULL, ttl = NULL,
#&gt;         wrap_ttl = NULL)
#&gt;     help()
#&gt;     list()
#&gt;     login(token = NULL, quiet = FALSE)
#&gt;     lookup(token = NULL)
#&gt;     lookup_accessor(accessor)
#&gt;     lookup_self()
#&gt;     renew(token, increment = NULL)
#&gt;     renew_self(increment = NULL)
#&gt;     revoke(token)
#&gt;     revoke_accessor(accessor)
#&gt;     revoke_and_orphan(token)
#&gt;     revoke_self()
#&gt;     role_delete(role_name)
#&gt;     role_list()
#&gt;     role_read(role_name)
#&gt;     role_write(role_name, allowed_policies = NULL,
#&gt;         disallowed_policies = NULL, orphan = NULL, period = NULL,
#&gt;         renewable = NULL, explicit_max_ttl = NULL, path_suffix = NULL,
#&gt;         bound_cidrs = NULL, token_type = NULL)
#&gt;     tidy()</div><div class='input'>
<span class='co'># The client is not authenticated by default:</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/try'>try</a></span>(<span class='no'>client</span>$<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='st'>"/secret"</span>))

<span class='co'># A few methods are unauthenticated and can still be run</span>
<span class='no'>client</span>$<span class='fu'>status</span>()</div><div class='output co'>#&gt; $type
#&gt; [1] "shamir"
#&gt; 
#&gt; $initialized
#&gt; [1] TRUE
#&gt; 
#&gt; $sealed
#&gt; [1] FALSE
#&gt; 
#&gt; $t
#&gt; [1] 1
#&gt; 
#&gt; $n
#&gt; [1] 1
#&gt; 
#&gt; $progress
#&gt; [1] 0
#&gt; 
#&gt; $nonce
#&gt; [1] ""
#&gt; 
#&gt; $version
#&gt; [1] "1.0.0"
#&gt; 
#&gt; $migration
#&gt; [1] FALSE
#&gt; 
#&gt; $cluster_name
#&gt; [1] "vault-cluster-e346306f"
#&gt; 
#&gt; $cluster_id
#&gt; [1] "78c7ba44-7311-c7e3-42cb-1c82c728dd3a"
#&gt; 
#&gt; $recovery_seal
#&gt; [1] FALSE
#&gt; </div><div class='input'>
<span class='co'># Login to the vault, using the token that we know from the server -</span>
<span class='co'># ordinarily you would use a login approach suitable for your needs</span>
<span class='co'># (see the vault documentation).</span>
<span class='no'>token</span> <span class='kw'>&lt;-</span> <span class='no'>server</span>$<span class='no'>token</span>
<span class='no'>client</span>$<span class='fu'>login</span>(<span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"token"</span>, <span class='kw'>token</span> <span class='kw'>=</span> <span class='no'>token</span>)</div><div class='output co'>#&gt; <span class='message'>Verifying token</span></div><div class='input'>
<span class='co'># The vault contains no secrets at present</span>
<span class='no'>client</span>$<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='st'>"/secret"</span>)</div><div class='output co'>#&gt; character(0)</div><div class='input'>
<span class='co'># Secrets can contain any (reasonable) number of key-value pairs,</span>
<span class='co'># passed in as a list</span>
<span class='no'>client</span>$<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/write'>write</a></span>(<span class='st'>"/secret/users/alice"</span>, <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>password</span> <span class='kw'>=</span> <span class='st'>"s3cret!"</span>))

<span class='co'># The whole list can be read out</span>
<span class='no'>client</span>$<span class='fu'>read</span>(<span class='st'>"/secret/users/alice"</span>)</div><div class='output co'>#&gt; $password
#&gt; [1] "s3cret!"
#&gt; </div><div class='input'><span class='co'># ...or just a field</span>
<span class='no'>client</span>$<span class='fu'>read</span>(<span class='st'>"/secret/users/alice"</span>, <span class='st'>"password"</span>)</div><div class='output co'>#&gt; [1] "s3cret!"</div><div class='input'>
<span class='co'># Reading non-existant values returns NULL, not an error</span>
<span class='no'>client</span>$<span class='fu'>read</span>(<span class='st'>"/secret/users/bob"</span>)</div><div class='output co'>#&gt; NULL</div><div class='input'>
<span class='no'>client</span>$<span class='fu'>delete</span>(<span class='st'>"/secret/users/alice"</span>)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#environment-variables">Environment variables</a></li>

      <li><a href="#methods">Methods</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Rich FitzJohn</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Rich FitzJohn, Robert Ashton, Wes Hinsley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

